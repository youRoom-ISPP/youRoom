{% extends 'base/base.html' %}
{% load static %}
{% load l10n %}

{% block titulo_pagina %}Perfil de usuario{% endblock %}
{% block titulo %}Perfil de usuario{% endblock %}

{% block contenido %}
<div class="row">
    <header class="col-12 detalles-usuario card">
        <div class="row mb-2 align-items-center">
            <div class="col-8"><h5>{{user.user.username}}</h5>
            </div>
        </div>
        <section class="row">
            <div class="col-12">
                <pre class="descripcion-usuario">{{user.descripcion}}</pre>
            </div>
            <div class="col-12 align-self-center">
                <span id="publicaciones-totales" data-toggle="publicaciones-totales" data-trigger="click"
                    data-placement="top" data-content="Publicaciones totales">
                    <i class="bi bi-camera-fill ml-2"> {{numPublicaciones}} </i>
                </span>
                <span id="puntos-totales" data-toggle="puntos-totales" data-trigger="click" data-placement="top"
                    data-content="Roomies">
                    <i class="bi bi-trophy-fill primero ml-2"> {{user.totalPuntos}} </i>
                </span>
            </div>
        </section>
    </header>
</div>
<div class="row">
    <div class="col-12 pt-sm-3 timeline">
        {% for p in publicaciones %}
        <div>
            <div class="card mb-3">
                <div class="card-header bg-white">
                    <strong class="timeline-user">{{p.0.usuario.user.username}}</strong>
                </div>
                <div class="container-visor-timeline">
                    <img src="{{p.0.imagen.url}}" class="card-img-bottom">
                    {% for e in p.0.etiqueta_set.all %}
                    {% localize off %}
                    <a target="_blank" href="{{e.enlace}}">
                        <div id="{{e.nombre}}" class="etiqueta" style="left: {{e.coord_x}}%; top: {{e.coord_y}}%;">
                        </div>
                    </a>
                    {% endlocalize %}
                    {% endfor %}
                </div>
                <div class="card-body cuerpo-tarjeta">
                    <div class="row pl-1 bg-white">
                        <form id="v{{p.0.id}}">{% csrf_token %}
                            <fieldset class="rating">
                                <input {% if p.1 is 5 %} checked {% endif %} type="radio" id="star5P{{p.0.id}}" name="valoracionP{{p.0.id}}" value="5" />
                                <label class="full" for="star5P{{p.0.id}}" title="5 estrellas"></label>
                                <input {% if p.1 is 4 %} checked {% endif %} type="radio" id="star4P{{p.0.id}}" name="valoracionP{{p.0.id}}" value="4" />
                                <label class="full" for="star4P{{p.0.id}}" title="4 estrellas"></label>
                                <input {% if p.1 is 3 %} checked {% endif %} type="radio" id="star3P{{p.0.id}}" name="valoracionP{{p.0.id}}" value="3" />
                                <label class="full" for="star3P{{p.0.id}}" title="3 estrellas"></label>
                                <input {% if p.1 is 2 %} checked {% endif %} type="radio" id="star2P{{p.0.id}}" name="valoracionP{{p.0.id}}" value="2" />
                                <label class="full" for="star2P{{p.0.id}}" title="2 estrellas"></label>
                                <input {% if p.1 is 1 %} checked {% endif %} type="radio" id="star1P{{p.0.id}}" name="valoracionP{{p.0.id}}" value="1" />
                                <label class="full" for="star1P{{p.0.id}}" title="1 estrella"></label>
                            </fieldset>
                        </form>
                    </div>
                    <div class="row px-1 pt-1">
                        <p>{{p.0.descripcion}}</p>
                    </div>
                    {% if p.0.comentario_set.all|length > 2 %}
                    <div class="row px-1">
                        <a class="listado-usuarios" href="{% url 'mostrar_publicacion' publicacion_id=p.0.id %}"><small>Ver los {{p.0.comentario_set.all|length}} comentarios</small></a>
                    </div>
                    {% endif %}
                    {% if p.2|length > 0 %}
                    <div class="row px-1">
                        {% for c in p.2 %}
                        <p class="col-12 comentario mb-0 pl-0"><a class="listado-usuarios" href="{% url 'usuario' username=c.usuario.user.username %}"><strong class="timeline-user">{{c.usuario.user.username}}</strong></a> {{c.texto}}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <form id="formCom{{p.0.id}}" class="row pt-2">{% csrf_token %}
                        <div class="col-10 px-1">
                            <input class="comentar" name="texto" required type="text" placeholder="Introduce tu comentario">
                        </div>
                        <div class="col-2 text-center">
                            <button id="comentarP{{p.0.id}}" class="boton-comentar"><i class="bi bi-chat-fill"></i></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
